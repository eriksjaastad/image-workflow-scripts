# September Data Fix - PNG-Only Counting

**Date:** October 15, 2025  
**Issue:** September dashboard showed inflated numbers (20k-28k files) because it was counting **all companion files** (PNG + YAML + captions) instead of just PNGs.

## Root Cause

Two places were using `file_count` (all files) instead of counting PNG files only:

1. **`cleanup_logs.py`** - Daily summary generation
2. **`data_engine.py`** - Project chart aggregation

## Fixes Applied

### 1. `scripts/cleanup_logs.py` (lines 149-163)

**Before:**
```python
file_count = op.get('file_count', 0)
script_summaries[script]['total_files'] += file_count or 0
```

**After:**
```python
# Count PNG files only (not companion files like YAML, captions, etc.)
files_list = op.get('files', [])
png_count = sum(1 for f in files_list if isinstance(f, str) and f.lower().endswith('.png'))

# Fallback to file_count if no files list
if not files_list and op.get('file_count'):
    png_count = op.get('file_count', 0)

script_summaries[script]['total_files'] += png_count
```

### 2. `scripts/dashboard/data_engine.py` (lines 654-665)

**Before:**
```python
value = record.get('file_count', 0)
aggregated[time_key][project_title] += value
```

**After:**
```python
# Count PNG files only (not companion files)
files_list = record.get('files', [])
png_count = sum(1 for f in files_list if isinstance(f, str) and f.lower().endswith('.png'))

# Fallback to file_count if no files list (for daily summary records)
if not files_list and record.get('file_count'):
    png_count = record.get('file_count', 0)

aggregated[time_key][project_title] += png_count
```

### 3. Re-backfilled September Summaries

Deleted and regenerated all September 2025 daily summaries with PNG-only counts.

## Results

**Before (with companion files):**
- Sept 22: ~31,000 files
- Sept 23: ~28,000 files  
- Sept 24: ~24,000 files

**After (PNG-only):**
- Sept 22: **27,248 PNGs**
- Sept 23: **14,112 PNGs**
- Sept 24: **12,179 PNGs**

Numbers are now **roughly half** of before, which is correct since each PNG has a YAML companion.

## Timeline Order

The charts use chronological order (left = oldest, right = newest) as standard. This is consistent across all charts:
- Labels are generated by `build_time_labels()` in chronological order
- Data is aggregated using `_aggregate_to_baseline()` which preserves label order
- No `reverse: true` in chart configurations

## Next Steps

**Restart your dashboard** to see the corrected data:
```bash
# Kill existing dashboard
pkill -f productivity_dashboard.py

# Restart
python scripts/dashboard/productivity_dashboard.py
```

The September data should now show accurate PNG counts, not inflated companion-file counts!

---

**Files Modified:**
- `scripts/cleanup_logs.py`
- `scripts/dashboard/data_engine.py`  
- `data/daily_summaries/daily_summary_202509*.json` (regenerated)

